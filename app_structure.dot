digraph AppStructure {
    // Graph settings
    graph [fontsize=10 labelloc="t" label="App Structure" splines=true rankdir="LR"];
    node [shape=box style=rounded];
    edge [arrowhead=open];

    // Main components
    "Laptop" [color=blue];
    "iPhone" [color=green];
    "Apple Watch" [color=orange];
    "RealSense Depth Camera" [color=purple];

    // Connections between devices
    "Laptop" -> "iPhone" [label="UDP Communication"];
    "iPhone" -> "Apple Watch" [label="WCSession"];
    "RealSense Depth Camera" -> "Laptop" [label="Object Data (USB)"];

    // iPhone app structure
    subgraph cluster_iPhone {
        label="iPhone App";
        color=green;
        "ContentView" [label="Main View"];
        "UDPReceiver" [label="Receives data from Laptop"];
        "SpeechRecognitionManager" [label="Handles Speech Recognition"];
        "HapticEngine" [label="Controls Haptics"];

        "ContentView" -> "UDPReceiver" [label="Listen to data"];
        "ContentView" -> "SpeechRecognitionManager" [label="Start/Stop Speech"];
        "SpeechRecognitionManager" -> "UDPReceiver" [label="Send recognized keywords"];
        "SpeechRecognitionManager" -> "HapticEngine" [label="Adjust haptics"];
        "UDPReceiver" -> "Apple Watch" [label="Send direction/magnitude"];
    }

    // Apple Watch app structure
    subgraph cluster_AppleWatch {
        label="Apple Watch App";
        color=orange;
        "WatchContentView" [label="Main View"];
        "WatchViewModel" [label="Receives iPhone data"];
        "HapticFeedbackHandler" [label="Plays haptics"];

        "WatchContentView" -> "WatchViewModel" [label="Display received data"];
        "WatchViewModel" -> "HapticFeedbackHandler" [label="Trigger haptics"];
    }

    // Laptop software structure
    subgraph cluster_Laptop {
        label="Laptop Software";
        color=blue;
        "Python UDP Server" [label="Processes data from iPhone"];
        "RealSense API" [label="Fetch depth data"];
        "Path Planner" [label="Calculate navigation"];
        "Data Broadcaster" [label="Send data to iPhone"];

        "Python UDP Server" -> "RealSense API" [label="Request depth data"];
        "RealSense API" -> "Path Planner" [label="Provide object positions"];
        "Path Planner" -> "Data Broadcaster" [label="Send calculated directions"];
    }

    // External connections
    "SpeechRecognition" [label="Speech Recognition Framework" color=red];
    "Haptic Framework" [label="Core Haptics" color=red];

    // Linking external frameworks
    "SpeechRecognition" -> "SpeechRecognitionManager" [label="Recognized text"];
    "Haptic Framework" -> "HapticEngine" [label="Trigger haptic"];
    "Haptic Framework" -> "HapticFeedbackHandler" [label="Trigger watch haptics"];
}
